# Copyright Verizon Media. Licensed under the terms of the Apache 2.0 license. See LICENSE in the project root.

schema query {
  document query {
  }

  onnx-model encoder {
    file: files/question_encoder.onnx
    input  input_ids: input_ids
    input  attention_mask: attention_mask
    input  token_type_ids: token_type_ids
    output output_0: embeddings
  }

  rank-profile question_encoder {
    num-threads-per-search: 1

    function input_ids() {
      expression: tokenInputIds(32, query(query_token_ids))
    }

    function token_type_ids() {
      expression: tokenTypeIds(32, query(query_token_ids))
    }

    function attention_mask() {
      expression: tokenAttentionMask(32, query(query_token_ids))
    }

    function cls_embedding() {
        expression: onnxModel(encoder).embeddings{d0:0,d1:0}
    }

    first-phase {
      expression: random
    }

    summary-features {
      cls_embedding
      input_ids
      token_type_ids
      attention_mask
    }
  }

}
